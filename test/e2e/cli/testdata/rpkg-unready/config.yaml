commands:
  - args:
      - porchctl
      - repo
      - register
      - --namespace=rpkg-unready
      - --name=git
      - http://git-server.test-git-namespace.svc.cluster.local:8080/rpkg-unready
  - args:
      - porchctl
      - rpkg
      - clone
      - --namespace=rpkg-unready
      - https://github.com/nephio-project/porch.git
      - --directory=test/pkgs/unready/
      - --ref=test/pkgs/unready/v1
      - --repository=git
      - --workspace=clone-1
      - unready-edit
    stdout: |
      git-0e15bfcaef2194d2369902c6e77c8905e9190cbb created
  - args:
      - porchctl
      - rpkg
      - copy
      - --namespace=rpkg-unready
      - --workspace=copy-2
      - --replay-strategy=true
      - git-0e15bfcaef2194d2369902c6e77c8905e9190cbb
    stdout: "git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c created\n"
  - args:
      - porchctl
      - rpkg
      - propose
      - --namespace=rpkg-unready
      - git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
    stderr: "git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c failed (readiness conditions not met)\nError: errors:\n  readiness conditions not met \n"
    exitCode: 1
  - args:
      - porchctl
      - rpkg
      - approve
      - --namespace=rpkg-unready
      - git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
    stderr: "git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c failed (readiness conditions not met)\nError: errors:\n  readiness conditions not met \n"
    exitCode: 1
  - args:
      - porchctl
      - rpkg
      - pull
      - --namespace=rpkg-unready
      - git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
      - /tmp/porch-e2e/pkg-unready-git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
  - args:
      - kpt
      - fn
      - eval
      - --image
      - gcr.io/kpt-fn/search-replace:v0.2.0
      - --match-kind
      - Kptfile
      - /tmp/porch-e2e/pkg-unready-git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
      - --
      - by-path=status.conditions[0].status
      - put-value=True
    stderr: "[RUNNING] \"gcr.io/kpt-fn/search-replace:v0.2.0\" on 1 resource(s)\n  Results:\n    [info] status.conditions[0].status: Mutated field value to \"\\\"True\\\"\"\n"
  - args:
      - porchctl
      - rpkg
      - push
      - --namespace=rpkg-unready
      - git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
      - /tmp/porch-e2e/pkg-unready-git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
    stdout: |
      git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c pushed
  - args:
      - porchctl
      - rpkg
      - propose
      - --namespace=rpkg-unready
      - git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
    stdout: |
      git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c proposed
    exitCode: 0
  - args:
      - porchctl
      - rpkg
      - approve
      - --namespace=rpkg-unready
      - git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c
    stdout: |
      git-8387be408ec830b27c9dff4f90bbc6aacaccdd1c approved
    exitCode: 0
  