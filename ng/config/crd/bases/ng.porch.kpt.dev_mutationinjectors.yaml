---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: mutationinjectors.ng.porch.kpt.dev
spec:
  group: ng.porch.kpt.dev
  names:
    kind: MutationInjector
    listKind: MutationInjectorList
    plural: mutationinjectors
    singular: mutationinjector
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: MutationInjector is the Schema for the mutationinjectors API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: MutationInjectorSpec defines the desired state of MutationInjector
            properties:
              mutations:
                description: mutations to apply to the target PackageVariants
                items:
                  description: A mutation that should be applied to the downstream
                    package
                  properties:
                    custom:
                      description: Data for "Custom" type
                      properties:
                        kind:
                          description: unique identifier of the custom mutation type
                          type: string
                        parameters:
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                      required:
                      - kind
                      type: object
                    injectInlineObject:
                      description: Data for "InjectInlineObject" type
                      type: string
                    injectLatestPackageRevision:
                      description: Data for "InjectLatestPackageRevision" type
                      properties:
                        package:
                          type: string
                        repo:
                          type: string
                        subdir:
                          description: The path within the downstream package to insert
                            the package.
                          type: string
                      required:
                      - package
                      - repo
                      type: object
                    injectLiveObject:
                      description: Data for "InjectLiveObject" type
                      properties:
                        destination:
                          properties:
                            name:
                              type: string
                            namespace:
                              type: string
                          required:
                          - name
                          type: object
                        group:
                          type: string
                        kind:
                          type: string
                        source:
                          properties:
                            name:
                              type: string
                            namespace:
                              type: string
                          required:
                          - name
                          type: object
                        version:
                          type: string
                      required:
                      - destination
                      - source
                      type: object
                    injectObjectFromPackage:
                      description: Data for "InjectObjectFromPackage" type
                      properties:
                        destination:
                          description: The name/namespace of the injection point
                          properties:
                            name:
                              type: string
                            namespace:
                              type: string
                          required:
                          - name
                          type: object
                        group:
                          type: string
                        kind:
                          type: string
                        package:
                          type: string
                        repo:
                          type: string
                        revision:
                          type: string
                        source:
                          description: The name/namespace of the KRM object in the
                            package
                          properties:
                            name:
                              type: string
                            namespace:
                              type: string
                          required:
                          - name
                          type: object
                        version:
                          type: string
                      required:
                      - destination
                      - package
                      - repo
                      - revision
                      - source
                      type: object
                    injectPackageRevision:
                      description: Data for "InjectPackageRevision" type
                      properties:
                        package:
                          type: string
                        repo:
                          type: string
                        revision:
                          type: string
                        subdir:
                          description: The path within the downstream package to insert
                            the package.
                          type: string
                      required:
                      - package
                      - repo
                      - revision
                      type: object
                    manager:
                      default: ""
                      description: Name of the controller that manages the mutation
                        (may be empty)
                      type: string
                    mergePackageRevision:
                      description: Data for "MergePackageRevision" type
                      properties:
                        overwrite:
                          default: true
                          description: |-
                            If false: keep conflicting resources from the upstream package,
                            overwrite them otherwise.
                          type: boolean
                        package:
                          type: string
                        repo:
                          type: string
                        revision:
                          type: string
                      required:
                      - package
                      - repo
                      - revision
                      type: object
                    name:
                      description: Name and Manager fields together must uniquely
                        identify a mutation in the scope of a PackageVariant object.
                      type: string
                    pipeline:
                      description: Data for "PrependPipeline" and "AppendPipeline"
                        types
                      properties:
                        mutators:
                          description: Mutators defines a list of of KRM functions
                            that mutate resources.
                          items:
                            description: Function specifies a KRM function.
                            properties:
                              configMap:
                                additionalProperties:
                                  type: string
                                description: '`ConfigMap` is a convenient way to specify
                                  a function config of kind ConfigMap.'
                                type: object
                              configPath:
                                description: |-
                                  `ConfigPath` specifies a slash-delimited relative path to a file in the current directory
                                  containing a KRM resource used as the function config. This resource is
                                  excluded when resolving 'sources', and as a result cannot be operated on
                                  by the pipeline.
                                type: string
                              exclude:
                                description: |-
                                  `Exclude` are used to specify resources on which the function should NOT be executed.
                                  If not specified, all resources selected by `Selectors` are selected.
                                items:
                                  description: |-
                                    Selector specifies the selection criteria
                                    please update IsEmpty method if more properties are added
                                  properties:
                                    annotations:
                                      additionalProperties:
                                        type: string
                                      description: Annotations on the target resources
                                      type: object
                                    apiVersion:
                                      description: APIVersion of the target resources
                                      type: string
                                    kind:
                                      description: Kind of the target resources
                                      type: string
                                    labels:
                                      additionalProperties:
                                        type: string
                                      description: Labels on the target resources
                                      type: object
                                    name:
                                      description: Name of the target resources
                                      type: string
                                    namespace:
                                      description: Namespace of the target resources
                                      type: string
                                  type: object
                                type: array
                              exec:
                                description: "Exec specifies the function binary executable.\nThe
                                  executable can be fully qualified or it must exists
                                  in the $PATH e.g:\n\n\t exec: set-namespace\n\t
                                  exec: /usr/local/bin/my-custom-fn"
                                type: string
                              image:
                                description: "`Image` specifies the function container
                                  image.\nIt can either be fully qualified, e.g.:\n\n\timage:
                                  gcr.io/kpt-fn/set-labels\n\nOptionally, kpt can
                                  be configured to use a image\nregistry host-path
                                  that will be used to resolve the image path in case\nthe
                                  image path is missing (Defaults to gcr.io/kpt-fn).\ne.g.
                                  The following resolves to gcr.io/kpt-fn/set-labels:\n\n\timage:
                                  set-labels"
                                type: string
                              name:
                                description: |-
                                  `Name` is used to uniquely identify the function declaration
                                  this is primarily used for merging function declaration with upstream counterparts
                                type: string
                              selectors:
                                description: |-
                                  `Selectors` are used to specify resources on which the function should be executed
                                  if not specified, all resources are selected
                                items:
                                  description: |-
                                    Selector specifies the selection criteria
                                    please update IsEmpty method if more properties are added
                                  properties:
                                    annotations:
                                      additionalProperties:
                                        type: string
                                      description: Annotations on the target resources
                                      type: object
                                    apiVersion:
                                      description: APIVersion of the target resources
                                      type: string
                                    kind:
                                      description: Kind of the target resources
                                      type: string
                                    labels:
                                      additionalProperties:
                                        type: string
                                      description: Labels on the target resources
                                      type: object
                                    name:
                                      description: Name of the target resources
                                      type: string
                                    namespace:
                                      description: Namespace of the target resources
                                      type: string
                                  type: object
                                type: array
                            type: object
                          type: array
                        validators:
                          description: |-
                            Validators defines a list of KRM functions that validate resources.
                            Validators are not permitted to mutate resources.
                          items:
                            description: Function specifies a KRM function.
                            properties:
                              configMap:
                                additionalProperties:
                                  type: string
                                description: '`ConfigMap` is a convenient way to specify
                                  a function config of kind ConfigMap.'
                                type: object
                              configPath:
                                description: |-
                                  `ConfigPath` specifies a slash-delimited relative path to a file in the current directory
                                  containing a KRM resource used as the function config. This resource is
                                  excluded when resolving 'sources', and as a result cannot be operated on
                                  by the pipeline.
                                type: string
                              exclude:
                                description: |-
                                  `Exclude` are used to specify resources on which the function should NOT be executed.
                                  If not specified, all resources selected by `Selectors` are selected.
                                items:
                                  description: |-
                                    Selector specifies the selection criteria
                                    please update IsEmpty method if more properties are added
                                  properties:
                                    annotations:
                                      additionalProperties:
                                        type: string
                                      description: Annotations on the target resources
                                      type: object
                                    apiVersion:
                                      description: APIVersion of the target resources
                                      type: string
                                    kind:
                                      description: Kind of the target resources
                                      type: string
                                    labels:
                                      additionalProperties:
                                        type: string
                                      description: Labels on the target resources
                                      type: object
                                    name:
                                      description: Name of the target resources
                                      type: string
                                    namespace:
                                      description: Namespace of the target resources
                                      type: string
                                  type: object
                                type: array
                              exec:
                                description: "Exec specifies the function binary executable.\nThe
                                  executable can be fully qualified or it must exists
                                  in the $PATH e.g:\n\n\t exec: set-namespace\n\t
                                  exec: /usr/local/bin/my-custom-fn"
                                type: string
                              image:
                                description: "`Image` specifies the function container
                                  image.\nIt can either be fully qualified, e.g.:\n\n\timage:
                                  gcr.io/kpt-fn/set-labels\n\nOptionally, kpt can
                                  be configured to use a image\nregistry host-path
                                  that will be used to resolve the image path in case\nthe
                                  image path is missing (Defaults to gcr.io/kpt-fn).\ne.g.
                                  The following resolves to gcr.io/kpt-fn/set-labels:\n\n\timage:
                                  set-labels"
                                type: string
                              name:
                                description: |-
                                  `Name` is used to uniquely identify the function declaration
                                  this is primarily used for merging function declaration with upstream counterparts
                                type: string
                              selectors:
                                description: |-
                                  `Selectors` are used to specify resources on which the function should be executed
                                  if not specified, all resources are selected
                                items:
                                  description: |-
                                    Selector specifies the selection criteria
                                    please update IsEmpty method if more properties are added
                                  properties:
                                    annotations:
                                      additionalProperties:
                                        type: string
                                      description: Annotations on the target resources
                                      type: object
                                    apiVersion:
                                      description: APIVersion of the target resources
                                      type: string
                                    kind:
                                      description: Kind of the target resources
                                      type: string
                                    labels:
                                      additionalProperties:
                                        type: string
                                      description: Labels on the target resources
                                      type: object
                                    name:
                                      description: Name of the target resources
                                      type: string
                                    namespace:
                                      description: Namespace of the target resources
                                      type: string
                                  type: object
                                type: array
                            type: object
                          type: array
                      type: object
                    type:
                      description: Type selector enum for the union type
                      enum:
                      - Custom
                      - PrependPipeline
                      - AppendPipeline
                      - MergePackageRevision
                      - InjectPackageRevision
                      - InjectLatestPackageRevision
                      - InjectObject
                      - InjectLiveObject
                      - InjectInlineObject
                      - InjectObjectFromPackage
                      type: string
                  required:
                  - name
                  - type
                  type: object
                  x-kubernetes-validations:
                  - message: custom field is mandatory if type == Custom
                    rule: self.type != 'Custom' || has(self.custom)
                  - message: mergePackageRevision field is mandatory if type == MergePackageRevision
                    rule: self.type != 'MergePackageRevision' || has(self.mergePackageRevision)
                  - message: injectPackageRevision field is mandatory if type == InjectPackageRevision
                    rule: self.type != 'InjectPackageRevision' || has(self.injectPackageRevision)
                  - message: injectLatestPackageRevision field is mandatory if type
                      == InjectLatestPackageRevision
                    rule: self.type != 'InjectLatestPackageRevision' || has(self.injectLatestPackageRevision)
                  - message: injectLiveObject field is mandatory if type == InjectLiveObject
                    rule: self.type != 'InjectLiveObject' || has(self.injectLiveObject)
                  - message: injectInlineObject field is mandatory if type == InjectInlineObject
                    rule: self.type != 'InjectInlineObject' || has(self.injectInlineObject)
                  - message: injectObjectFromPackage field is mandatory if type ==
                      InjectObjectFromPackage
                    rule: self.type != 'InjectObjectFromPackage' || has(self.injectObjectFromPackage)
                  - message: pipeline field is mandatory if type == PrependPipeline
                    rule: self.type != 'PrependPipeline' || has(self.pipeline)
                  - message: pipeline field is mandatory if type == AppendPipeline
                    rule: self.type != 'AppendPipeline' || has(self.pipeline)
                type: array
              packageVariantSelector:
                description: defines the set of target PackageVariants
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements.
                      The requirements are ANDed.
                    items:
                      description: |-
                        A label selector requirement is a selector that contains values, a key, and an operator that
                        relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies
                            to.
                          type: string
                        operator:
                          description: |-
                            operator represents a key's relationship to a set of values.
                            Valid operators are In, NotIn, Exists and DoesNotExist.
                          type: string
                        values:
                          description: |-
                            values is an array of string values. If the operator is In or NotIn,
                            the values array must be non-empty. If the operator is Exists or DoesNotExist,
                            the values array must be empty. This array is replaced during a strategic
                            merge patch.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                      required:
                      - key
                      - operator
                      type: object
                    type: array
                    x-kubernetes-list-type: atomic
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: |-
                      matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                      map is equivalent to an element of matchExpressions, whose key field is "key", the
                      operator is "In", and the values array contains only "value". The requirements are ANDed.
                    type: object
                type: object
                x-kubernetes-map-type: atomic
            required:
            - packageVariantSelector
            type: object
          status:
            description: MutationInjectorStatus defines the observed state of MutationInjector
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
